{
    "collab_server" : "",
    "contents" : "library(e1071)\nlibrary(ggplot2)\nlibrary(caret)\nlibrary(fastICA)\nlibrary(reshape2)\n\nsource(\"helpers.R\")\n\n#' The following function displays the skewness of column vectors of a data frame,\n#' as bar- or density plot depending of the dimensions of th input data frame.\n#' @author Jens Hooge jens.hooge@gmail.com\n\n#' @title Skewness Plot.\n#' \n#' @description \\code{plotSkewness} plots the skewness of a distribution.\n#' \n#' @details\n#' \\code{plotSkewness} expects a data frame X, and computes the skewness of its\n#' column vectors. Skewness is a measure of asymmetry of a distribution. While a\n#' skewness of 0 indicates a perfectly symmetrical distribution, larger skewness values\n#' indicate that the density of values is higher for smaller values. In that case the\n#' distribution would be called right skewed. Vice versa, for negative values of skewness\n#' the distribution would be called left skewed. Skewness values between -2 and 2 indicate\n#' a roughly symmetric distribution. If the number of columns in X is smaller or equal to 50,\n#' skewness displayed in a barplot and a density plot otherwise.\n#' \n#' @param X real valued data frame\n#' \n#' @examples\n#' plotSkewness(mtcars)\n#' \n#' @return list{base}\nplotSkewness <- function(X) {\n  X <- as.data.frame(X) ## in case it is just a numeric vector\n  skewValues <- as.data.frame(sapply(X, skewness, na.rm=TRUE, type=1))\n  skewValues$variable <- rownames(skewValues)\n  rownames(skewValues) <- NULL\n  colnames(skewValues) <- c(\"skewnessValue\", \"variable\")\n  skewValues$variable <- as.factor(skewValues$variable)\n  \n  if (ncol(X) <= 50){\n    fig <- ggplot(skewValues, aes(x=variable, y=skewnessValue)) +\n      geom_bar(stat=\"identity\", position=\"dodge\") +\n      geom_hline(yintercept = 2, linetype = \"dashed\", color=\"red\") +\n      geom_hline(yintercept = -2, linetype = \"dashed\", color=\"red\") +\n      ylab(\"Skewness\") +\n      theme_bw() +\n      theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust=0.5))\n  } else {\n    fig <- ggplot(skewValues, aes(x=skewnessValue)) +\n      geom_density() +\n      geom_point(aes(x=skewnessValue, y = 0.0005),\n                 alpha = 0.25, size=4, colour=\"darkgray\") +\n      geom_vline(xintercept = 2, linetype = \"dashed\", color=\"red\") +\n      geom_vline(xintercept = -2, linetype = \"dashed\", color=\"red\") +\n      annotate(\"text\", x = Inf, y = Inf, label = sprintf(\"n=%i\", ncol(X)),\n               vjust=1.8, hjust=1.2) +\n      xlab(\"Skewness\") +\n      theme_bw()\n  }\n  return(fig)\n}\n\nplotPairs <- function(X) {\n  \n  #' plot absolute correlation coefficients (pearson) into panel\n  #' and adjust the text size according to the correlation\n  #' @param x numeric vector\n  #' @param y numeric vector\n  #' @return plot text element\n  #' \n  panel.cor <- function(x, y, digits = 2, prefix = \"\", cex.cor, ...) {\n    usr <- par(\"usr\"); on.exit(par(usr))\n    par(usr = c(0, 1, 0, 1))\n    r <- abs(cor(x, y))\n    txt <- format(c(r, 0.123456789), digits = digits)[1]\n    txt <- paste0(prefix, txt)\n    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)\n    text(0.5, 0.5, txt, cex = cex.cor * r)\n  }\n  \n  \n  #' plot histogram into diagonal panel of a numeric vector\n  #' @param x numeric vector\n  #' @return histogram with colored bars\n  #' \n  panel.hist <- function(x, ...) {\n    usr <- par(\"usr\"); on.exit(par(usr))\n    par(usr = c(usr[1:2], 0, 1.5) )\n    h <- hist(x, plot = FALSE)\n    breaks <- h$breaks; nB <- length(breaks)\n    y <- h$counts; y <- y/max(y)\n    rect(breaks[-nB], 0, breaks[-1], y, col = \"#67000D\", ...)\n  }\n  \n  \n  #' plot a smoothScatter (color density of a scatter plot) with a loess fit\n  #' into the panels \n  #' @param x numeric vector\n  #' @param y numeric vector\n  #' @return smoothed scatter plot\n  #' \n  panel.smoothScatter <- function (x, y, bg = NA, \n                                   cex = 1, col.smooth = \"red\",\n                                   span = 2/3, iter = 3, ...) {\n    # colors for the density\n    palette <- colorRampPalette(c(\"blue\", \"orange\", \"red\"))\n    s <- smoothScatter(x, y, colramp = palette, bg = bg, cex = cex, add=T)\n    ok <- is.finite(x) & is.finite(y)\n    if (any(ok)) \n      lines(stats::lowess(x[ok], y[ok], f = span, iter = iter), \n            col = col.smooth, ...)\n  }\n  \n  mat <- as.matrix(X)\n  fig <- pairs(mat,\n               lower.panel = panel.smoothScatter,\n               upper.panel = panel.cor,\n               diag.panel  = panel.hist)\n  return(fig)\n  \n  \n  # ### examples\n  # data(iris)\n  # myMatrix <- as.matrix(iris[,1:4])\n  # ### see ?pairs for more help\n  # pairs(myMatrix,\n  #       lower.panel = panel.smoothScatter,\n  #       upper.panel = panel.cor,\n  #       diag.panel  = panel.hist)\n  \n}\n\nplotCorMat <- function(X) {\n  corrmatrix <- cor(X)\n  corrdata=as.data.frame(corrmatrix)\n  corrdata$Variable1=names(corrdata)\n  corrdatamelt=melt(corrdata,id=\"Variable1\")\n  names(corrdatamelt)=c(\"Variable1\",\"Variable2\",\"CorrelationCoefficient\")\n  corrmatplot = rPlot(Variable2 ~ Variable1, color = 'CorrelationCoefficient', data = corrdatamelt, type = 'tile', height = 600)\n  corrmatplot$addParams(height = 400, width=800)\n  corrmatplot$guides(\"{color: {scale: {type: gradient2, lower: 'red',  middle: 'white', upper: 'blue',midpoint: 0}}}\")\n  corrmatplot$guides(y = list(numticks = length(unique(corrdatamelt$Variable1))))\n  corrmatplot$guides(x = list(numticks = 3))\n  #corrmatplot$addParams(staggerLabels=TRUE)\n  corrmatplot\n}\n\nqqPlot <- function(values) {\n  df <- data.frame(values=values)\n  fig <- ggplot(df, aes(sample = values)) +\n    stat_qq(alpha=0.5) + \n    geom_abline(intercept = mean(df$values),\n                slope = sd(df$values),\n                colour=\"red\") +\n    labs(title=\"QQ Plot\") +\n    theme_bw() +\n    theme(plot.title   = element_text(size=25),\n          axis.text.x  = element_text(size=20),\n          axis.title.x = element_text(size=25),\n          axis.text.y  = element_text(size=20),\n          axis.title.y = element_text(size=25),\n          legend.title = element_blank(),\n          legend.text  = element_text(size=15))\n  \n  return(fig)\n}\n\nfeatureClassPlot <- function(df) {\n  df <- as.data.frame(table(sapply(df, class)))\n  colnames(df) <- c(\"Type\", \"Freq\")\n  df<- df[with(df, order(-Freq)), ]\n  df$Type <- as.factor(df$Type)\n  df$Type <- factor(df$Type, levels=df$Type[order(df$Freq)], ordered=TRUE)\n  \n  fig <- ggplot(data=df) + \n    geom_bar(aes(Type, Freq), stat=\"identity\", position=\"dodge\") +\n    labs(title = \"Feature Types\") +\n    labs(x = \"Type\", y = \"Absolute Frequency\") + \n    theme_bw() +\n    theme(plot.title   = element_text(size=18),\n          strip.text.y = element_text(size=14, angle=0),\n          axis.text.x  = element_text(size=12, angle=0),\n          axis.text.y  = element_text(size=12),\n          axis.title.x = element_text(size=10),\n          axis.title.y = element_text(size=10),          \n          legend.position = \"none\")\n  \n  return(fig)\n}\n\npcaPlot <- function(X, label) {\n  Y <- X[, label]\n  X <- X[, -which(names(X) == label)]\n  X_projected <- pcaTransform(X)\n  # preProc   = preProcess(X, method=c(\"center\", \"scale\", \"pca\"))\n  # X_projected = predict(preProc, X)[, 1:3] # PCA projection\n  \n  projection <- data.frame(Label=Y,\n                           PC1=X_projected[, 1], \n                           PC2=X_projected[, 2],\n                           PC3=X_projected[, 3])\n  \n  tools <- c(\"pan\", \"resize\", \n             \"wheel_zoom\", \"box_zoom\", \n             \"box_select\", \"lasso_select\", \n             \"reset\", \"save\")\n  \n  cols <- 2:ncol(projection)\n  nms <- expand.grid(names(projection)[cols], \n                     rev(names(projection)[cols]), \n                     stringsAsFactors = FALSE)\n  splom_list <- vector(\"list\", 9)\n  for(ii in seq_len(nrow(nms))) {\n    splom_list[[ii]] <- figure(width = 200, height = 200, tools = tools,\n                               xlab = nms$Var1[ii], ylab = nms$Var2[ii]) %>%\n      ly_points(nms$Var1[ii], nms$Var2[ii], \n                data = projection,\n                color = Label, \n                size = 6, \n                hover=list(Label),\n                legend = FALSE)\n  }\n  grid_plot(splom_list, ncol = 3, same_axes = TRUE, link_data = TRUE)\n}\n\nicaPlot <- function(X, label, n.comp) {\n  Y <- X[, label]\n  X <- X[, -which(names(X) == label)]\n  X_projected <- icaTransform(X)\n\n  projection <- data.frame(Label=Y,\n                           IC1=X_projected[, 1], \n                           IC2=X_projected[, 2],\n                           IC3=X_projected[, 3])\n  \n  tools <- c(\"pan\", \"resize\", \n             \"wheel_zoom\", \"box_zoom\", \n             \"box_select\", \"lasso_select\", \n             \"reset\", \"save\")\n  \n  cols <- 2:ncol(projection)\n  nms <- expand.grid(names(projection)[cols], \n                     rev(names(projection)[cols]), \n                     stringsAsFactors = FALSE)\n  splom_list <- vector(\"list\", 9)\n  for(ii in seq_len(nrow(nms))) {\n    splom_list[[ii]] <- figure(width = 200, height = 200, tools = tools,\n                               xlab = nms$Var1[ii], ylab = nms$Var2[ii]) %>%\n      ly_points(nms$Var1[ii], nms$Var2[ii], \n                data = projection,\n                color = Label, \n                size = 6, \n                hover=list(Label),\n                legend = FALSE)\n  }\n  grid_plot(splom_list, ncol = 3, same_axes = TRUE, link_data = TRUE)\n}\n\n\n\n\n\n### STILL TODO\nexplVarPCAplot <- function(X) {\n  preProc <- preProcess(X, method=c(\"pca\", \"center\", \"scale\"))\n  numComp <- preProc$numComp\n  df <- data.frame(Component=colnames(preProc$rotation),\n                   ExplVariance=preProc$trace[1:numComp])\n  \n  fig <- figure(width = 600, height = 600) %>%\n    ly_points(df, x=Component, y=ExplVariance, \n              hover = list(ExplVariance))\n  fig\n}\n\nexplVarICAplot <- function(X) {\n  preProc <- preProcess(X, method=c(\"ica\", \"center\", \"scale\"))\n  numComp <- preProc$numComp\n  df <- data.frame(Component=colnames(preProc$rotation),\n                   ExplVariance=preProc$trace[1:numComp])\n  \n  fig <- figure(width = 600, height = 600) %>%\n    ly_points(df, x=Component, y=ExplVariance, \n              hover = list(ExplVariance))\n  fig\n}\n\n## This function crashes the RStudio session for some reason. tsne works rtsne does not!\ntsnePlot <- function(X, label) {\n  Y <- X[, label]\n  X <- X[, -which(names(X) == label)]\n  X_projected <- tsneTransform(X)\n  \n  projection <- data.frame(Label=Y,\n                           Comp1=X_projected[, 1], \n                           Comp2=X_projected[, 2],\n                           Comp3=X_projected[, 3])\n  \n  tools <- c(\"pan\", \"resize\", \n             \"wheel_zoom\", \"box_zoom\", \n             \"box_select\", \"lasso_select\", \n             \"reset\", \"save\")\n  \n  cols <- 2:ncol(projection)\n  nms <- expand.grid(names(projection)[cols], \n                     rev(names(projection)[cols]), \n                     stringsAsFactors = FALSE)\n  splom_list <- vector(\"list\", 9)\n  for(ii in seq_len(nrow(nms))) {\n    splom_list[[ii]] <- figure(width = 200, height = 200, tools = tools,\n                               xlab = nms$Var1[ii], ylab = nms$Var2[ii]) %>%\n      ly_points(nms$Var1[ii], nms$Var2[ii], \n                data = projection,\n                color = Label, \n                size = 6, \n                hover=list(Label),\n                legend = FALSE)\n  }\n  grid_plot(splom_list, ncol = 3, same_axes = TRUE, link_data = TRUE)\n}\n",
    "created" : 1460358077326.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "32|29|61|0|\n63|26|131|0|\n133|27|146|0|\n148|28|166|0|\n264|31|274|0|\n276|31|286|0|\n289|32|320|0|\n",
    "hash" : "2616653145",
    "id" : "5106D29E",
    "lastKnownWriteTime" : 1460371626,
    "last_content_update" : 1460371626985,
    "path" : "~/workspace/R/projects/ShinyDashboardExample/visualizations.R",
    "project_path" : "visualizations.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}